<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Image Filter</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div class="text-center p-5 mb-0 bg-primary text-white">
    <h1>Filter</h1>
</div>

<nav class="navbar navbar-expand-lg bg-black navbar-dark mb-0">
    <div class="container-fluid">
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/wavefunctioncollapse">Wave Function Collapse</a></li>
                <li class="nav-item"><a class="nav-link" href="/filter">Filter</a></li>
                <li class="nav-item"><a class="nav-link" href="/pixelArt">Pixel Art</a></li>
                <li class="nav-item"><a class="nav-link" href="/dotted">Dotted</a></li>
                <li class="nav-item"><a class="nav-link" href="/gallery">Gallery</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4 text-center">
    <h2>Image Filter</h2>

    <input type="file" id="upload" accept="image/*" class="form-control mt-3">
    <canvas id="canvas" class="border mt-3"></canvas>
    <button class="btn btn-primary mt-3" onclick="apply()">Apply Random Filter</button>
</div>

<script>
let img = null;

document.getElementById("upload").onchange = e => {
    const f = e.target.files[0];
    if (!f) return;
    img = new Image();
    img.onload = () => draw(img);
    img.src = URL.createObjectURL(f);
};

function draw(image) {
    const c = document.getElementById("canvas");
    const x = c.getContext("2d");
    c.width = image.width;
    c.height = image.height;
    x.drawImage(image, 0, 0);
}

function apply() {
    if (!img) return;
    const c = document.getElementById("canvas");
    const x = c.getContext("2d");

    const s = 0.1 + Math.random() * 1.9;
    const w = img.width * s;
    const h = img.height * s;

    c.width = w;
    c.height = h;

    const f = Math.random() < 0.5 ? -1 : 1;
    x.save();
    x.scale(1, f);
    x.drawImage(img, 0, f === 1 ? 0 : -h, w, h);
    x.restore();

    const d = x.getImageData(0, 0, w, h);
    const p = d.data;

    const r = Math.random() * 120;
    const g = Math.random() * 120;
    const b = Math.random() * 120;

    for (let i = 0; i < p.length; i += 4) {
        p[i] += r;
        p[i+1] += g;
        p[i+2] += b;
    }

    x.putImageData(d, 0, 0);
}
</script>

</body>
</html>
